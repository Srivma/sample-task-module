<!DOCTYPE html>
<html>
  <body>
    <audio controls autoplay></audio>
    <script
      src="https://unpkg.com/@microsoft/teams-js@1.3.7/dist/MicrosoftTeams.min.js"></script>
      <script type="text/javascript" src="recorder.js"></script>
      <script type="text/javascript" src="/scripts/bundle.js"></script>
    <fieldset>
      <legend>RECORD AUDIO</legend>
      <input onclick="startRecording()" type="button" value="start recording" />
      <input
        onclick="stopRecording()"
        type="button"
        value="stop recording and play"
      />
    </fieldset>
    <script>
      microsoftTeams.initialize();
      var onFail = function(e) {
        console.log("Rejected!", e);
      };

      var onSuccess = function(s) {
        var AudioContext = window.AudioContext || window.webkitAudioContext;
        var context = new AudioContext();
        var mediaStreamSource = context.createMediaStreamSource(s);
        recorder = new Recorder(mediaStreamSource);
        recorder.record();
      };

      window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;
        navigator.getUserMedia =
        navigator.mediaDevices.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia ||
        navigator.msGetUserMedia;

      var recorder;
      var audio = document.querySelector("audio");

      function startRecording() {
        // Request access to the media devices
        navigator.mediaDevices
          .getUserMedia({
            audio: true
          })
          .then(function(stream) {
            // Initialize the recorder
            this.onSuccess(stream);
          })
          .catch(function(error) {
            console.error("Cannot access media devices: ", error);
          });
      }
      function stopRecording() {
        recorder.stop();
        recorder.exportWAV(function(s) {
          audio.src = window.URL.createObjectURL(s);
          let audioInfo = {
          name: audio.src,
          }
          microsoftTeams.tasks.submitTask(audioInfo);
        });
      }
    </script>
  </body>
</html>
